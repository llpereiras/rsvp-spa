<h1>
  {{title}}
</h1>

<div class="well">
  <label for="search_convidado">Pesquisar convidado</label>
  <input class="form-control" [(ngModel)]="convidado_selecionado" auto-complete [source]="convidados" />
  <label for="select_credencial">Selecione a credencial</label>
  <select class="form-control" [(ngModel)]="credencial_selecionada">
    <option *ngFor="let credencial of credenciais" [value]="credencial.id">{{credencial.descricao}}</option>
  </select>
  <br>
  <button type="button" class="btn btn-success" on-click="add(evento_selecionado)" [disabled]="saving" >
    <span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Adicionar
  </button>
  <button type="button" class="btn btn-warning pull-right" on-click="convidado_selecionado = ''" >
    <i class="fa fa-eraser" aria-hidden="true"></i>
    Limpar consulta
  </button>
</div>

<div class="row">
  <div class="col-xs-4 col-xs-offset-4 col-sm-4 col-sm-offset-0 col-lg-4 col-lg-offset-0">
    <h3 *ngIf="evento_selecionado">O evento acontecerá no dia {{evento_selecionado.data | date:"dd/MM/yyyy"}}</h3>
    <h3>Abaixo os já convidados para o evento</h3>
  </div>
</div>
<hr>

<div class="row">
  <div class="btn badge"></div>
</div>
<table class="table table-hover table-condensed" *ngFor="let ec of eventos_convidados | apenas_convidados">
  <tbody >
    <tr class="success">
      <td colspan="5" style="text-align: center;"> <strong> {{ec.convidado.nome}} </strong></td>
      <td>
        <button class="btn btn-warning" routerLink="/convidados/{{ec.convidado.id}}">
          <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Editar
        </button>
      </td>
      <td>
        <button class="btn btn-danger" on-click="excluir(ec.id)">
          <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Excluir
        </button>
      </td>
    </tr>
    <tr class="convidado_info">
      <td><strong>E-mail</strong></td>
      <td><strong>Telefone</strong></td>
      <td><strong>Credencial</strong></td>
      <td><strong>Obs</strong>.</td>
      <td><strong>Convites</strong></td>
      <td>
        <strong>
          Confirmado?
          <span [innerHtml]="ec.confirmado === true ? 'Sim' :  'Não'"></span>
        </strong>
      </td>
      <td>
        <strong>
          Presença?
          <span [innerHtml]="ec.hora_chegada? 'Sim' :  'Não'"></span>
        </strong>
      </td>
    </tr>
    <tr>
      <td>{{ec.convidado.email}}</td>
      <td>{{ec.convidado.telefone}}</td>
      <td>{{ec.credencial.descricao}}</td>
      <td>{{ec.observacoes}}</td>
      <td>
        <!-- Convites -->
        &nbsp;
      </td>
      <td>
        <span *ngIf="ec.confirmado" class="btn btn-info btn-xs">
          <span class="badge">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
          </span>
        </span>
        <span *ngIf="!ec.confirmado">
          <button on-click="confirmar_presenca(ec.id)" class="btn btn-success btn-xs">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            Confirmar
          </button>
        </span>
      </td>
      <td>
        <span *ngIf="ec.hora_chegada" class="btn btn-info btn-xs">
          <span class="badge">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ec.hora_chegada  | date:"dd/MM/yyyy HH:mm:ss" }}
          </span>
        </span>
        <span *ngIf="!ec.hora_chegada">
          <button on-click="marcar_hora(ec.id)" class="btn btn-success btn-xs">
            <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
            Marcar presença</button>
        </span>
      </td>
    </tr>
    <tr>
        <td colspan="7" align="center">
          <div class="panel-group" id="acc_{{ec.id}}" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="headingOne{{ec.convidado.id}}">
                <h4 class="panel-title">
                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne{{ec.convidado.id}}" aria-expanded="true" aria-controls="collapseOne">
                    <button class="btn btn-success" >
                      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Acompanhante
                    </button>
                  </a>
                </h4>
              </div>
              <div id="collapseOne{{ec.convidado.id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                    <eventos-acompanhantes acompanhante="acompanhante" convidado="{{ec.convidado.id}}"></eventos-acompanhantes>
                    <h3>Acompanhantes</h3>
                    <table class="table table-hover table-condensed" >
                      <thead>
                        <th><strong>Nome</strong></th>
                        <th><strong>E-mail</strong></th>
                        <th><strong>Telefone</strong></th>
                        <th><strong>Credencial</strong></th>
                        <th><strong>Obs</strong>.</th>
                      </thead>
                      <tbody>
                        <tr *ngFor="let acompanha of eventos_convidados | apenas_acompanhantes:ec.convidado.id">
                            <td>{{acompanha.convidado.nome}}</td>
                            <td>{{acompanha.convidado.email}}</td>
                            <td>{{acompanha.convidado.telefone}}</td>
                            <td>{{acompanha.credencial.descricao}}</td>
                            <td>{{acompanha.convidado.observacoes}}</td>
                        </tr>
                      </tbody>
                    </table>
                </div>
              </div>
            </div>
          </div>
          <hr>
        </td>
    </tr>
  </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" *ngIf="evento_selecionado">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Novo acompanhante - {{evento_selecionado.nome}}</h4>
      </div>
      <div class="modal-body">
        <convidados-create acompanhante="acompanhante"></convidados-create>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>
